<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>WNIT Intelligence ‚ú®</title>

<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;1,400&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet" />

<style>
:root {
  --bg-dark: #050505;
  --card-bg: #121212;
  --gold: #D2C2B2; /* Muted Gold/Tan Color */
  --text-main: #EAEAEA;
  --border: rgba(210, 194, 178, 0.25);
}

* { box-sizing: border-box; }

body {
  margin: 0;
  background-color: var(--bg-dark);
  font-family: 'Poppins', sans-serif;
  color: var(--text-main);
  height: 100vh;
  display: flex;
  flex-direction: column;
  overflow: hidden;
}

/* HEADER */
.header {
  height: 70px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 0 40px;
  border-bottom: 1px solid var(--border);
  background: rgba(5, 5, 5, 0.95);
  z-index: 10;
}
.brand { font-family: 'Poppins', sans-serif; font-weight: 700; font-size: 18px; color: var(--text-main); }
.brand span { color: var(--gold); }
.nav-link { color: #9CA3AF; text-decoration: none; font-size: 14px; transition: 0.3s; }
.nav-link:hover { color: var(--gold); }

/* CHAT AREA */
.chat-container {
  flex: 1;
  overflow-y: auto;
  padding: 30px 20px 140px;
  scroll-behavior: smooth;
  width: 100%;
  max-width: 1200px;
  margin: 0 auto;
}
.chat-container::-webkit-scrollbar { width: 6px; }
.chat-container::-webkit-scrollbar-thumb { background: #333; border-radius: 4px; }

/* MESSAGES */
.msg-row { display: flex; margin-bottom: 30px; width: 100%; }
.user-row { justify-content: flex-end; }
.msg-bubble {
  padding: 16px 24px;
  border-radius: 12px;
  font-size: 15px;
  max-width: 700px;
}
.user-msg { background: var(--gold); color: #000; font-weight: 600; border-radius: 20px 20px 0 20px; }
.ai-msg { background: transparent; padding: 0; width: 100%; max-width: 100%; }

/* --- CITY HEADER --- */
.city-header-block {
  margin-top: 40px;
  margin-bottom: 20px;
  border-bottom: 1px solid var(--border);
  padding-bottom: 10px;
}
.city-title {
  font-family: 'Playfair Display', serif;
  font-size: 28px;
  color: var(--gold);
  letter-spacing: 1px;
}

/* --- GRID --- */
.results-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
  gap: 24px;
  width: 100%;
}

/* --- CARD DESIGN --- */
.card {
  background: var(--card-bg);
  border-radius: 20px;
  overflow: hidden;
  border: 1px solid rgba(255,255,255,0.08);
  transition: all 0.3s ease;
  cursor: pointer;
  display: flex;
  flex-direction: column;
  position: relative;
  height: 100%;
}
.card:hover { 
  transform: translateY(-5px); 
  border-color: var(--gold); 
  box-shadow: 0 10px 30px rgba(0,0,0,0.5); 
}

.card-img-wrapper { height: 200px; width: 100%; position: relative; overflow: hidden; }
.card-img { width: 100%; height: 100%; object-fit: cover; transition: 0.5s; }
.card:hover .card-img { transform: scale(1.05); }

.match-badge {
  position: absolute; top: 12px; left: 12px;
  background: var(--gold); color: #000;
  font-size: 11px; font-weight: 800;
  padding: 5px 12px; border-radius: 50px;
  z-index: 2;
}

.card-body { padding: 22px; flex: 1; display: flex; flex-direction: column; }

/* Name & Rating */
.card-header-group { margin-bottom: 15px; }
.card-title {
  font-family: 'Playfair Display', serif; font-size: 22px; font-weight: 600;
  margin: 0 0 6px 0; color: var(--text-main); line-height: 1.2;
}
.card-rating-line {
  font-size: 13px; color: #ccc; display: flex; align-items: center; gap: 8px;
}
.star { color: var(--gold); }

/* Insight Box */
.insight-box {
  background: rgba(255,255,255,0.03);
  border-radius: 12px; padding: 16px;
  margin-bottom: 20px; border-left: 3px solid var(--gold);
}
.insight-label { font-size: 10px; color: var(--gold); font-weight: 700; margin-bottom: 6px; letter-spacing: 1px; }
.insight-text { font-size: 13px; color: #bbb; line-height: 1.5; font-style: italic; }

/* View Details Link (Replaces Button) */
.view-details {
  margin-top: auto; 
  align-self: flex-end;
  color: var(--gold);
  font-size: 11px;
  font-weight: 700;
  text-transform: uppercase;
  letter-spacing: 1px;
  display: flex;
  align-items: center;
  gap: 5px;
  transition: 0.3s;
}
.card:hover .view-details {
  color: #fff;
  transform: translateX(5px);
}

/* Discovery Note */
.discovery-note {
  margin: 40px auto 10px;
  padding: 15px;
  border: 1px dashed var(--border);
  border-radius: 10px;
  color: #888;
  font-size: 13px;
  text-align: center;
  max-width: 600px;
  background: rgba(210, 194, 178, 0.05);
}

/* INPUT */
.input-area {
  position: fixed; bottom: 30px; left: 50%; transform: translateX(-50%);
  width: 90%; max-width: 700px; z-index: 20;
}
.search-wrapper {
  background: rgba(20, 20, 20, 0.95); backdrop-filter: blur(15px);
  border: 1px solid rgba(255,255,255,0.15); border-radius: 50px;
  padding: 8px 8px 8px 24px; display: flex; align-items: center;
  box-shadow: 0 10px 40px rgba(0,0,0,0.6);
  transition: border-color 0.3s;
}
.search-wrapper:focus-within { border-color: var(--gold); }

.search-input { flex: 1; background: transparent; border: none; color: #fff; font-size: 16px; outline: none; }
.send-btn {
  width: 48px; height: 48px; border-radius: 50%; background: var(--gold);
  border: none; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: 0.2s;
}
.send-btn:hover { background: #fff; }
</style>
</head>

<body>

  <header class="header">
    <div class="brand">WNIT <span>INTELLIGENCE</span></div>
    <a href="/" class="nav-link">BACK TO HOME</a>
  </header>

  <div id="chat" class="chat-container">
    <div class="msg-row">
      <div class="msg-bubble" style="background: rgba(255,255,255,0.05); color: #ddd;">
        Hello! I am your city guide. Ask about <b>restaurants, cafes, or nightlife</b>. üåÜ
      </div>
    </div>
  </div>

  <div class="input-area">
    <div class="search-wrapper">
      <input id="query" class="search-input" placeholder="Ask anything... (e.g. 'Good food in Indore')" autocomplete="off" onkeypress="if(event.key==='Enter') sendQuery()" />
      <button class="send-btn" onclick="sendQuery()">‚û§</button>
    </div>
  </div>

<script>
async function sendQuery() {
  const input = document.getElementById("query");
  const text = input.value.trim();
  if (!text) return;

  input.value = "";
  const chat = document.getElementById("chat");

  // User Msg
  chat.innerHTML += `<div class="msg-row user-row"><div class="msg-bubble user-msg">${text}</div></div>`;
  setTimeout(() => chat.scrollTop = chat.scrollHeight, 50);

  // Loading
  const thinkingId = 'thinking-' + Date.now();
  chat.innerHTML += `<div id="${thinkingId}" class="msg-row"><div class="msg-bubble" style="color:#888;">Thinking...</div></div>`;
  chat.scrollTop = chat.scrollHeight;

  try {
    const res = await fetch("/ai-search", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ query: text })
    });
    const data = await res.json();
    document.getElementById(thinkingId).remove();

    if (!data.results || Object.keys(data.results).length === 0) {
      chat.innerHTML += `<div class="msg-row"><div class="msg-bubble" style="color:#fff;">No results found. Try a different city.</div></div>`;
    } else {
      
      let htmlContent = `<div class="msg-row"><div class="ai-msg">`;
      let totalCities = Object.keys(data.results).length;

      // --- Loop for Each City ---
      for (const city in data.results) {
        
        // 1. CITY HEADER
        htmlContent += `
          <div class="city-header-block">
            <div class="city-title">üìç ${city}</div>
          </div>
          <div class="results-grid">
        `;

        data.results[city].forEach(r => {
          
          // 2. DATA PROCESSING
          const cuisine = r.cuisines ? r.cuisines.split(',')[0] : "Fine Dining";
          const rating = r.rating || "N/A";
          const location = r.location || city;
          const cost = r.cost_for_two || 1500;
          const matchPercent = Math.round(r.score * 100);
          
          // 3. DYNAMIC INSIGHT LOGIC
          let insight = "";
          if (rating != "N/A" && rating >= 4.5) {
             insight = `A highly-rated gem in ${location}. Exceptional ${cuisine} cuisine with a ${rating}-star experience.`;
          } else if (cost < 800) {
             insight = `Delicious ${cuisine} food at an unbeatable price. A popular budget-friendly spot in ${location}.`;
          } else if (cost > 2500) {
             insight = `A luxurious destination for ${cuisine} lovers. Perfect for special occasions and fine dining.`;
          } else {
             insight = `Known for its great ambiance and ${cuisine} dishes. Matches your preference for ${location}.`;
          }

          // Fallback Image
          const imgUrl = r.image || 'https://images.unsplash.com/photo-1552566626-52f8b828add9?auto=format&fit=crop&w=800&q=80';

          htmlContent += `
            <div class="card" onclick="window.location.href='/restaurant/${r.id || '#'}'">
              <div class="card-img-wrapper">
                 <div class="match-badge">${matchPercent}% MATCH</div>
                 <img src="${imgUrl}" class="card-img" alt="${r.name}">
              </div>
              
              <div class="card-body">
                <div class="card-header-group">
                    <h3 class="card-title">${r.name}</h3>
                    <div class="card-rating-line">
                        <span class="star">‚òÖ</span> ${rating} ‚Ä¢ ${cuisine.toUpperCase()}
                    </div>
                </div>
                
                <div class="insight-box">
                  <div class="insight-label">‚ú® WHY YOU'LL LOVE IT</div>
                  <div class="insight-text">${insight}</div>
                </div>

                <div class="view-details">VIEW DETAILS ‚Üí</div>
              </div>
            </div>
          `;
        });

        htmlContent += `</div>`; // Grid Close
      }

      // 4. DISCOVERY MODE DISCLAIMER
      if (totalCities > 1 || text.split(' ').length < 3) {
        htmlContent += `
          <div class="discovery-note">
            ‚ö†Ô∏è <b>Discovery Mode:</b> Showing top picks across regions.<br> 
            Please provide specific <b>city, cuisine, and rating</b> for best results.
          </div>
        `;
      }

      htmlContent += `</div></div>`;
      chat.innerHTML += htmlContent;
    }

    chat.scrollTop = chat.scrollHeight;

  } catch (err) {
    document.getElementById(thinkingId)?.remove();
    console.error(err);
    chat.innerHTML += `<div class="msg-row"><div class="msg-bubble" style="color:red;">Server Error.</div></div>`;
  }
}
</script>

</body>
</html>